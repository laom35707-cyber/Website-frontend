<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ´ æŠ½å¡å¤§å… Â· é’¢ç´æç®€ç‰ˆ</title>
    <!-- æç®€é»‘ç™½ç° Â· è‡´æ•¬ Chilly Gonzales ã€ŠSolo Piano IIIã€‹ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">
    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           çº¯é»‘ / çº¯ç™½ / æç®€ç°é˜¶ Â· ç»†çº¿ Â· é™è°§ç•™ç™½  
          æ‰€æœ‰å½©è‰²å½»åº•ç§»é™¤ â€”â€” ä»…å‰©é’¢ç´ç´é”®èˆ¬çš„å…‹åˆ¶ 
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            background: #ffffff;                /* çº¯ç™½èƒŒæ™¯ï¼Œæ— æ‚è´¨ */
            font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif;
            color: #000000;
            line-height: 1.6;
            padding: 3.5rem 2rem;
            min-height: 100vh;
            position: relative;
            filter: grayscale(1);              /* æ‰€æœ‰è‰²å½©è¤ªå»â€”â€”é»‘ç™½ç´é”® */
            font-weight: 400;
            letter-spacing: 0.02em;
        }

        /* å½»åº•ç§»é™¤æ‰€æœ‰å½©è‰²æ¸å˜ã€ä¼ªå…ƒç´ ã€é˜´å½± â€” åªå‰©é»‘ç™½æ„æˆ */
        body::before {
            display: none;
        }

        .magazine-container {
            max-width: 860px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        /* ===== æ ‡é¢˜åŒº Â· è¡¬çº¿åŠ›é‡ ===== */
        .title-block {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-bottom: 4.8rem;
            border-bottom: 1px solid #000000;   /* ç»†çº¿ï¼Œåˆ©è½ */
            padding-bottom: 1.2rem;
            flex-wrap: wrap;
        }

        .title-main {
            font-family: 'Playfair Display', 'Georgia', 'Times New Roman', serif;
            font-size: 3.2rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            color: #000000;
            line-height: 1;
            text-transform: uppercase;           /* åŠ›åº¦æ„Ÿï¼Œå¤§å†™ */
        }

        .title-main span {
            background: #000000;                /* çº¯é»‘å— */
            color: #ffffff;                   /* çº¯ç™½å­— */
            padding: 0.3rem 1rem 0.2rem 1rem;
            font-size: 1.2rem;
            font-weight: 700;
            margin-left: 0.8rem;
            border-radius: 0;                /* ç›´è§’ï¼Œç»å¯¹ç®€çº¦ */
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.1em;
            display: inline-block;
            border: 1px solid #000000;
        }

        .back-link {
            background: transparent;
            border: 1px solid #000000;
            border-radius: 0;
            padding: 0.6rem 1.8rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: #000000;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.15s ease, opacity 0.15s;
            line-height: 1;
        }

        .back-link:hover {
            background: rgba(0, 0, 0, 0.04);   /* æå¾®å¼±ç° */
            border-color: #000000;
        }

        .back-link:active {
            background: rgba(0, 0, 0, 0.1);
        }

        /* ===== ä¸‰æšç»Ÿè®¡æ ‡ç­¾ Â· çº¿æ¡ä¸ç•™ç™½ ===== */
        .stats-bar {
            display: flex;
            gap: 32px;
            margin-bottom: 64px;
            flex-wrap: wrap;
        }

        .stat-chip {
            background: #ffffff;
            border: 1px solid #000000;
            border-radius: 0;
            padding: 0.6rem 1.8rem 0.6rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            font-size: 0.95rem;
            color: #000000;
            box-shadow: none;
            backdrop-filter: none;
        }

        .stat-chip .emoji {
            font-size: 1.6rem;
            filter: grayscale(1);
            opacity: 0.9;
        }

        .stat-chip .value {
            font-size: 2rem;
            font-weight: 700;
            color: #000000;
            margin-left: 6px;
            line-height: 1;
            letter-spacing: -0.02em;
        }

        /* ===== å•æ±  Â· çº¯ç²¹æ„æˆ ===== */
        .pool-single {
            background: #ffffff;
            border: 1px solid #000000;
            border-radius: 0;
            padding: 40px 36px;
            margin-bottom: 64px;
            box-shadow: none;
            backdrop-filter: none;
        }

        .pool-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 36px;
        }

        .pool-icon {
            font-size: 3rem;
            filter: grayscale(1);
            line-height: 1;
        }

        .pool-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 800;
            color: #000000;
            letter-spacing: -0.01em;
            border-bottom: 1px solid #000;
            line-height: 1.2;
        }

        /* æŠ½å¡åˆ¸ â€”â€” å·¨å¤§æ•°å­—ï¼Œå®‰é™çš„åŠ›é‡ */
        .ticket-count {
            background: #ffffff;
            border: 1px solid #000000;
            border-radius: 0;
            padding: 18px 28px;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            color: #000000;
        }

        .ticket-number {
            font-size: 3.4rem;
            font-weight: 800;
            color: #000000;
            line-height: 1;
            font-family: 'Inter', sans-serif;
        }

        /* æŒ‰é’® Â· ç»†è¾¹æ¡† Â· çº¯ç²¹ç°åº¦äº¤äº’ */
        .button-group {
            display: flex;
            gap: 24px;
            margin-top: 12px;
        }

        .btn {
            flex: 1;
            padding: 16px 0;
            border: 1px solid #000000;
            border-radius: 0;
            background: #ffffff;
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: background 0.15s, opacity 0.15s;
            box-shadow: none;
            color: #000000;
            letter-spacing: 0.06em;
        }

        .btn:hover {
            background: rgba(0, 0, 0, 0.04);  /* ä»…é€æ˜åº¦å˜åŒ–ï¼Œå…‹åˆ¶ */
            border-color: #000000;
        }

        .btn:active {
            background: rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            opacity: 0.3;
            background: #ffffff;
            border-color: #7a7a7a;
            color: #7a7a7a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            pointer-events: none;
        }

        .btn-primary, .btn-secondary {
            background: #ffffff;
            color: #000000;
        }

        /* ===== å±•å»Š Â· æš—ç›’ ===== */
        .result-gallery {
            background: #ffffff;
            border: 1px solid #000000;
            border-radius: 0;
            padding: 36px 32px;
            margin-top: 20px;
            box-shadow: none;
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 32px;
            border-bottom: 1px solid #d0d0d0;
            padding-bottom: 14px;
        }

        .gallery-header h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 800;
            color: #000000;
            letter-spacing: -0.01em;
        }

        .badge {
            background: #000000;
            color: #ffffff;
            padding: 4px 16px;
            border-radius: 0;
            font-size: 0.85rem;
            font-weight: 600;
            border: none;
            letter-spacing: 0.1em;
        }

        /* å¡ç‰‡ç½‘æ ¼ Â· ç°åº¦å±‚æ¬¡ */
        .card-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 24px;
            max-height: 400px;
            overflow-y: auto;
            padding: 6px 4px 12px 4px;
        }

        .reward-item {
            background: #ffffff;
            border-left: 6px solid #000000;   /* é»˜è®¤é»‘æ¡ */
            border-top: 1px solid #e6e6e6;
            border-right: 1px solid #e6e6e6;
            border-bottom: 1px solid #e6e6e6;
            border-radius: 0;
            padding: 18px 16px;
            box-shadow: none;
            transition: background 0.1s;
        }

        /* ç¨€æœ‰åº¦ä»…ç”¨ç°é˜¶æ˜åº¦åŒºåˆ† â€”â€” Næµ…ç° / Rä¸­ç° / SSRé»‘ */
        .reward-item.N {
            border-left-color: #b3b3b3;
        }
        .reward-item.R {
            border-left-color: #666666;
        }
        .reward-item.SSR {
            border-left-color: #1a1a1a;
        }

        .reward-rarity {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 4px 10px;
            background: #f0f0f0;
            color: #000000;
            border-radius: 0;
            display: inline-block;
            margin-bottom: 14px;
            letter-spacing: 0.1em;
            border: none;
        }

        .reward-name {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #1a1a1a;
            word-break: break-word;
        }

        /* å…‘æ¢åˆ¸ã€åŒå¡ç­‰æ ‡è¯† â€” æ— è‰²å½©ï¼Œçº¯ç²¹ç°åº¦ */
        .reward-item [style*="font-size:0.6rem"] {
            font-size: 0.6rem !important;
            margin-top: 12px;
            color: #555555 !important;
            border-top: 1px dashed #aaa;
            padding-top: 8px;
            font-weight: 500;
        }

        .empty-wall {
            grid-column: 1 / -1;
            text-align: center;
            padding: 70px 0;
            color: #6b6b6b;
            font-weight: 400;
            font-style: italic;
            font-size: 1rem;
            border: 1px solid #f0f0f0;
            background: #fafafa;
        }

        /* è„šæ³¨ Â· ä½è°ƒ */
        .colophon {
            margin-top: 64px;
            text-align: right;
            font-size: 0.75rem;
            color: #6a6a6a;
            border-top: 1px solid #cccccc;
            padding-top: 20px;
            font-style: italic;
            letter-spacing: 0.1em;
            font-weight: 300;
        }

        /* æ‰€æœ‰ emoji å½»åº•ç°åº¦ (å…¨å±€ grayscale å·²å¤„ç†ï¼Œä½†äºŒæ¬¡ç¡®ä¿) */
        .pool-icon, .stat-chip .emoji, .btn span, .back-link span, .reward-name {
            filter: grayscale(1);
        }

        /* ä¿ç•™çº¯é»‘çº¯ç™½ï¼Œç§»é™¤æ‰€æœ‰å½©è‰²é—ç•™ */
        a, a:visited {
            color: #000000;
        }

        /* å“åº”å¼ Â· ç•™ç™½ä¾ç„¶ */
        @media (max-width: 600px) {
            body {
                padding: 2rem 1.2rem;
            }
            .title-main {
                font-size: 2.4rem;
            }
            .pool-single {
                padding: 28px 22px;
            }
            .ticket-number {
                font-size: 2.6rem;
            }
            .stats-bar {
                gap: 16px;
            }
            .stat-chip {
                padding: 0.5rem 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="magazine-container">
        <div class="title-block">
            <div class="title-main">ğŸ´ æŠ½å¡å¤§å… <span>Vol.2</span></div>
            <a href="reward.html" class="back-link"><span style="font-size:1.2rem;">â†</span> è¿”å›å¥–åŠ±ä¸­å¿ƒ</a>
        </div>

        <div class="stats-bar">
            <div class="stat-chip"><span class="emoji">ğŸ´</span><span>STUD</span><span class="value" id="studDisplay">0</span></div>
            <div class="stat-chip"><span class="emoji">ğŸ’°</span><span>å‚¨å¤‡é‡‘</span><span class="value" id="reserveDisplay">150</span></div>
            <div class="stat-chip"><span class="emoji">ğŸ’§</span><span>æµåŠ¨èµ„é‡‘</span><span class="value" id="flowDisplay">0</span></div>
        </div>

        <!-- å•ä¸€å¡æ±  Â· é™è°§æŠ½åˆ¸ -->
        <div class="pool-single">
            <div class="pool-header">
                <span class="pool-icon">ğŸŸï¸</span>
                <span class="pool-title">ç»Ÿä¸€å¡æ± </span>
            </div>
            <div class="ticket-count">
                <span>æŠ½å¡åˆ¸</span>
                <span class="ticket-number" id="ticketCount">0</span>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="draw1Btn">ğŸ² æŠ½1æ¬¡</button>
                <button class="btn btn-secondary" id="draw10Btn">ğŸ“¦ åè¿æŠ½</button>
            </div>
            <div style="margin-top:28px; font-size:0.8rem; color:#5a5a5a; text-align:center; border-top:1px solid #d4d4d4; padding-top:18px; letter-spacing:0.05em;">
                âš¡ 5%åŒå¡ Â· Nå¡å«é›¶é£Ÿ Â· å°STUD 10~80åæ¯” Â· ä¿åº•ç»§æ‰¿
            </div>
        </div>

        <div class="result-gallery">
            <div class="gallery-header">
                <h3>ğŸ–¼ï¸ æŠ½å¡å±•å»Š Â· æœ€æ–°å…¥è—</h3>
                <span class="badge" id="resultCount">0 ä»¶</span>
            </div>
            <div id="resultWall" class="card-wall">
                <div class="empty-wall">âœ¨ è¿˜æ²¡æœ‰æŠ½å¡è®°å½•ï¼Œè§¦ç¢°è‰ºæœ¯å§ âœ¨</div>
            </div>
        </div>
        <div class="colophon">STUDæ¿€åŠ±ç³»ç»Ÿ Â· ç»Ÿä¸€å¡æ±  Â· é›¶é£Ÿä¸Šçº¿</div>
    </div>

    <script>
        // ---------- å®Œå…¨ä¿ç•™åŸæŠ½å¡é€»è¾‘ï¼ŒUI å·²å½»åº•å˜å¥ä¸ºé»‘ç™½ç´é”® ----------
        const API_BASE = '';
        const RESULT_MAX = 30;
        let currentResults = [];

        async function api(path, opts = {}) {
            const url = API_BASE + '/api/' + path;
            const res = await fetch(url, {
                method: opts.method || 'GET',
                headers: { 'Content-Type': 'application/json' },
                body: opts.body ? JSON.stringify(opts.body) : undefined
            });
            if (!res.ok) throw new Error(await res.text());
            return res.json();
        }

        async function refreshUI() {
            try {
                const status = await api('status');
                document.getElementById('studDisplay').innerText = status.stud ?? 0;
                document.getElementById('reserveDisplay').innerText = status.reserve ?? 150;
                document.getElementById('flowDisplay').innerText = status.flow ?? 0;

                const inv = status.inventory || [];
                let ticket = 0;
                inv.forEach(item => {
                    if (item.type === 'gacha_ticket') ticket += (item.amount || 1);
                });
                document.getElementById('ticketCount').innerText = ticket;
                document.getElementById('draw1Btn').disabled = (ticket === 0);
                document.getElementById('draw10Btn').disabled = (ticket < 10);
                return status;
            } catch (e) {
                console.error('åˆ·æ–°å¤±è´¥', e);
            }
        }

        async function drawOnce() {
            try {
                const res = await api('gacha', { method: 'POST', body: {} });
                if (res.results) renderResults(res.results);
                await refreshUI();
            } catch (e) {
                alert(`æŠ½å¡å¤±è´¥: ${e.message}`);
            }
        }

        async function drawTen() {
            const btn = document.getElementById('draw10Btn');
            btn.disabled = true;
            try {
                for (let i = 0; i < 10; i++) {
                    await drawOnce();
                    await new Promise(r => setTimeout(r, 150));
                }
            } finally {
                btn.disabled = false;
                refreshUI();
            }
        }

        function renderResults(newResults) {
            const wall = document.getElementById('resultWall');
            if (!wall) return;
            newResults.forEach(r => {
                let title = '';
                let rarityClass = r.rarity || 'N';
                if (r.rarity === 'N') title += '[N] ';
                else if (r.rarity === 'R') title += '[R] ';
                else if (r.rarity === 'SSR') title += '[SSR] ';

                if (r.type === 'drink') title += `ğŸ¥¤ ${r.subtype}`;
                else if (r.type === 'coffee') title += `â˜• ${r.subtype}`;
                else if (r.type === 'food_double') title += `ğŸ” ${r.brand}åŒé¤ (${r.meal}+${r.extraMeal})`;
                else if (r.type === 'food') title += `ğŸŸ ${r.brand}Â·${r.meal}`;
                else if (r.type === 'snack') title += `ğŸ« ${r.subtype}`;
                else if (r.type === 'fly') title += 'ğŸ›« èµ·é£é€šè¡Œè¯';
                else if (r.type === 'fly_convert') title += `âœˆï¸ èµ·é£è½¬åŒ– (${r.amount} STUD)`;
                else if (r.type === 'stud_small') title += `ğŸ“˜ STUD +${r.amount}`;
                else if (r.type === 'super_stud') title += `âœ¨ è¶…çº§STUDåŒ… (${r.amount} STUD)`;
                else if (r.type === 'unlock_small') title += `ğŸ”“ å°è§£é”åˆ¸ (${r.amount}å…ƒ)`;
                else if (r.type === 'unlock_big') title += `ğŸ”“ å¤§è§£é”åˆ¸ (${r.amount}å…ƒ)`;
                else if (r.type === 'parent_pay') title += `ğŸ’³ çˆ¶æ¯ä¹°å•åˆ¸ (${r.amount}å…ƒ)`;
                else if (r.type === 'unlock_all') title += `ğŸ‰ èµ„é‡‘å…¨è§£é”`;
                else title += r.type;

                const cardHtml = `
                    <div class="reward-item ${rarityClass}">
                        <span class="reward-rarity">${r.rarity || 'N'}</span>
                        <div class="reward-name">${title}</div>
                        ${r.fromExchange ? '<div style="font-size:0.6rem;margin-top:8px;color:#555;">ğŸ”„ å…‘æ¢åˆ¸</div>' : ''}
                        ${r.fromDouble ? '<div style="font-size:0.6rem;margin-top:8px;color:#444;">âš¡ åŒå¡</div>' : ''}
                    </div>
                `;
                currentResults.unshift(cardHtml);
            });
            if (currentResults.length > RESULT_MAX) currentResults = currentResults.slice(0, RESULT_MAX);
            if (currentResults.length === 0) {
                wall.innerHTML = '<div class="empty-wall">âœ¨ è¿˜æ²¡æœ‰æŠ½å¡è®°å½•ï¼Œè§¦ç¢°è‰ºæœ¯å§ âœ¨</div>';
            } else {
                wall.innerHTML = currentResults.join('');
            }
            document.getElementById('resultCount').innerText = `${currentResults.length} ä»¶`;
        }

        window.onload = async () => {
            await refreshUI();
            currentResults = [];
            document.getElementById('resultWall').innerHTML = '<div class="empty-wall">âœ¨ è¿˜æ²¡æœ‰æŠ½å¡è®°å½•ï¼Œè§¦ç¢°è‰ºæœ¯å§ âœ¨</div>';
            document.getElementById('resultCount').innerText = '0 ä»¶';
            document.getElementById('draw1Btn').addEventListener('click', drawOnce);
            document.getElementById('draw10Btn').addEventListener('click', drawTen);
        };
    </script>
</body>
</html>